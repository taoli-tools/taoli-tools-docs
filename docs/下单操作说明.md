# 下单操作说明

## MKT 市价单

![image.png](%E4%B8%8B%E5%8D%95%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E/image.png)

- Sequence：
    - Parallel：A 和 B 同时下单。
    - A then B：等 A 下单成功后再下 B 单。如果 A 下单失败，则 B 不会下单，并且 Loop 不会停止。
    - B then A：等 B 下单成功后再下 A 单。如果 B 下单失败，则 A 不会下单，并且 Loop 不会停止。

无论选择哪种模式，都有可能会出现只有单边成交的情况。建议哪边容易失败就优先哪边。

如果交易所 API 返回成功但实际没有下单成功，仍然会被认为是下单成功。

> [!TIP]
> 如果使用 Market 下单模式，很可能会由于网络延迟的问题出现实际成交价与下单价格不符，也可能会因为 Size 设置过大导致吃到了买 2 卖 2 价。

## LMT 限价单

![image.png](%E4%B8%8B%E5%8D%95%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E/image%201.png)

- MaxO：最大单边未成交的挂单数量，单位是订单。有可能会因为下单请求延迟，或者未成交订单没有及时更新等问题导致未成交订单数超过这个数字。
- VA，VB：
    - 价距。即委托价与买一卖一价的价差，单位是百分比。
        - V<0，超价吃单，能尽快成交，但可能会亏。
        - V=0，按卖一买一价挂单。
        - V>0，相当于一上一下网格单，不能立即成交。
    - 不同的交易所，以及不同的交易对的 V 最大值和最小值都不一样，如果超出范围，输入框会显示红色，此时可能仍然可以下单，但有可能超出交易的限价单价格范围，从而下单失败。
    - 如果你设置的差价为 0.5%，VA 为-0.1%，VB 为-0.2%，那么除去手续费你最少可以赚 0.2%。
    - 如果你设置的差价为 0.5%，VA 为 0.1%，VB 为 0.2%，那么除去手续费你最少可以赚 0.8%。

> [!TIP]
> 如果使用 Limit 下单模式，可能会由于市场的价格波动导致只有单边成交，未成交的订单会以黄色字体显示。这时可以去交易所里修改订单价格，认亏。或者做时间的朋友，硬撑。

## FLAT 持仓平衡

![image.png](%E4%B8%8B%E5%8D%95%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E/image%202.png)

![image.png](%E4%B8%8B%E5%8D%95%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E/image%203.png)

- 勾选后，该 Pair 每次双边下单前会检测持仓是否平衡
- 如果发现 A 和 B 的持仓的绝对值相差超过或等于 Size，则会出现黄色字警告，不会下单，也不会中断 Loop

## 下单数量及仓位限制

![image.png](%E4%B8%8B%E5%8D%95%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E/image%204.png)

- Size：单次下单的数量，单位是币。如果不填，就无法下单。
- MinA：Min A Position。A 的最小持仓量，单位是币。-A+B 时，如果仓位数量即将小于这个数，则会暂停下单，黄色字报错`A: Position will be less than MinA`，但不会停止 Loop。如果是现货，只能填大于等于 0 的数，否则可以填负数。
- MaxA：Max A Position。A 的最大持仓量，单位是币。+A-B 时，如果仓位数量即将大于这个数，则会暂停下单，黄色字报错`A: Position will be greater than MaxA`，但不会停止 Loop。
- 只会限制 A，不会限制 B。
- 可能会因为请求延迟，或者持仓量没有及时更新等问题导致有一两单超出。
- 黄色的未成交挂单也会算在内。

按住 Shift 后：

![image.png](%E4%B8%8B%E5%8D%95%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E/image%205.png)

- $MinA：Min A Position Value。A 的最小持仓量，单位是 U。-A+B 时，如果仓位价值即将小于这个数，则会暂停下单，黄色字报错`A: Position value will be less than $MinA`，但不会停止 Loop。如果是现货，只能填大于等于 0 的数，否则可以填负数。
- $MaxA：Max A Position Value。A 的最大持仓量，单位是 U。买入或做多时，如果仓位价值即将大于这个数，则会暂停下单，黄色字报错`A: Position value will be greater than $MaxA`，但不会停止 Loop。
- 即使不再按 Shift，只要填写了$MinA 和$MaxA，就会持续生效。并且和 MinA 和 MaxA 一起都有效，逻辑上是“and”的关系。
- 黄色的未成交挂单也会算在内。

## 设置差价及下单

![image.png](%E4%B8%8B%E5%8D%95%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E/image%206.png)

第一列：

- 两种交易方向：-A+B，+A-B。-减号是指做空合约或卖出现货；+加号是指做多合约或者买入现货。
- 点击-A+B 或+A-B 可以看到两种交易方向的历史差价图表。左上角可以选择蜡烛宽度单位，以及按照 OHLC 中的哪个数字来计算差价图表。

![image.png](%E4%B8%8B%E5%8D%95%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E/image%207.png)

第二列：

- **当前差价**，买 1 卖 1 价，单位是百分比。不论哪种交易方向，只要差价是正数，就说明有得赚（不算手续费的情况下）。
- -A+B 的差价计算方式：(A Bid 1 - B Ask 1) * 2 / (A Bid 1 + B Ask 1)。再乘 100，显示为百分比。
- +A-B 的差价计算方式：(B Bid 1 - A Ask 1) * 2 / (B Bid 1 + A Ask 1)。再乘 100，显示为百分比。

第三列：

- **预设差价**，可自己调整，单位是百分比。
- 可以调整为负数，意味着愿意亏差价进行交易。
- 如果不填，就无法下单。

第四列：

- Once：点击时如果**当前差价**大于等于**预设差价**，就会直接按照**当前差价**下单，如果不满足，则会等待下单。最多只会下一单。

第五列：

- Loop：点击后开始等待下单，当**当前差价**大于等于**预设差价**后，循环按照**当前差价**下单。直至出现未知错误。可能会出现只有单边成交的情况。如果想要无人值守需谨慎。

## 单边下单

![image.png](%E4%B8%8B%E5%8D%95%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E/image%208.png)

- 按下 Shift 按键后，下单按钮会变成图中所示，此时会忽略设置的差价，每点一次下一单。
- 一边的价格过期也不会影响另一边的单边下单。

## Pair 操作

![image.png](%E4%B8%8B%E5%8D%95%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E/image%209.png)

从左到右：

- 删除交易对，删除交易对并不会对实际持仓产生任何影响，只是从网页上消失。
- 复制出一个相同的 Pair。
- 最小化交易对，不影响交易对的运行。

按下 Shift 按键后：

![image.png](%E4%B8%8B%E5%8D%95%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E/image%2010.png)

从左到右：

- 向上移动 Pair 的位置，Once 或 Loop 等待下单时不能移动。
- 复制出一个相同的 Pair，但 A 和 B 交换位置，N 变为倒数，MinA 和 MaxA 会对调，Sequence 也会变。
- 向下移动 Pair 的位置，Once 或 Loop 等待下单时不能移动。

> [!TIP]
> 请不要关闭或最小化网页，会导致无法触发下单。
